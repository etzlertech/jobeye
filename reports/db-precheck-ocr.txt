# OCR Migration Preflight Report

Timestamp: 2025-10-13T12:17:58.849Z
Supabase URL: https://rtwigjwqufozqfwozpvo.supabase.co

## Status
❌ **FAILED** – Issues detected (see below).

### Issues
- **inventory_images**: Missing required columns: file_path

## Table Snapshot
| Table | Row count | Tenant column | Notes |
|-------|-----------|---------------|-------|
| `vendors` | 1 | Present | OK |
| `inventory_images` | 2 | Present | Missing: file_path |
| `ocr_jobs` | 1 | Present | OK |
| `ocr_documents` | 1 | Present | OK |
| `ocr_line_items` | 1 | Present | OK |
| `ocr_note_entities` | 1 | Present | OK |
| `vendor_aliases` | 1 | Present | OK |
| `vendor_locations` | 1 | Present | OK |

## Table Details
### vendors
- Category: dependency
- Exists: Yes
- Row count: 1
- Missing columns: None
- Columns:
  - id: uuid, nullable=NO (default: gen_random_uuid())
  - name: text, nullable=NO
  - is_active: boolean, nullable=YES (default: true)
  - created_at: timestamp with time zone, nullable=YES (default: now())
  - updated_at: timestamp with time zone, nullable=YES (default: now())
  - intake_session_id: uuid, nullable=YES
  - tenant_id: uuid, nullable=YES
- Indexes:
  - vendors_pkey: CREATE UNIQUE INDEX vendors_pkey ON public.vendors USING btree (id)

### inventory_images
- Category: dependency
- Exists: Yes
- Row count: 2
- Missing columns:
  - file_path (Image location)
- Columns:
  - id: uuid, nullable=NO (default: gen_random_uuid())
  - tenant_id: uuid, nullable=NO
  - item_type: text, nullable=NO
  - item_id: uuid, nullable=NO
  - image_url: text, nullable=NO
  - thumbnail_url: text, nullable=YES
  - is_primary: boolean, nullable=YES (default: false)
  - angle: text, nullable=YES
  - aspect_ratio: numeric, nullable=YES (default: 1.0)
  - original_width: integer, nullable=YES
  - original_height: integer, nullable=YES
  - crop_box: jsonb, nullable=YES
  - metadata: jsonb, nullable=YES (default: '{}'::jsonb)
  - captured_by: uuid, nullable=YES
  - captured_at: timestamp with time zone, nullable=YES (default: now())
  - created_at: timestamp with time zone, nullable=YES (default: now())
- Indexes:
  - idx_inventory_images_item: CREATE INDEX idx_inventory_images_item ON public.inventory_images USING btree (item_type, item_id)
  - idx_inventory_images_item_lookup: CREATE INDEX idx_inventory_images_item_lookup ON public.inventory_images USING btree (item_type, item_id, is_primary DESC, created_at DESC)
  - idx_inventory_images_tenant: CREATE INDEX idx_inventory_images_tenant ON public.inventory_images USING btree (tenant_id)
  - inventory_images_pkey: CREATE UNIQUE INDEX inventory_images_pkey ON public.inventory_images USING btree (id)

### ocr_jobs
- Category: ocr
- Exists: Yes
- Row count: 1
- Missing columns: None
- Columns:
  - id: uuid, nullable=NO (default: gen_random_uuid())
  - tenant_id: text, nullable=NO
  - vendor_id: uuid, nullable=YES
  - status: text, nullable=NO
  - created_at: timestamp with time zone, nullable=YES (default: now())
  - completed_at: timestamp with time zone, nullable=YES
- Indexes:
  - ocr_jobs_pkey: CREATE UNIQUE INDEX ocr_jobs_pkey ON public.ocr_jobs USING btree (id)

### ocr_documents
- Category: ocr
- Exists: Yes
- Row count: 1
- Missing columns: None
- Columns:
  - id: uuid, nullable=NO (default: gen_random_uuid())
  - tenant_id: text, nullable=NO
  - ocr_job_id: uuid, nullable=YES
  - file_path: text, nullable=NO
  - page_count: integer, nullable=YES
  - created_at: timestamp with time zone, nullable=YES (default: now())
- Indexes:
  - ocr_documents_pkey: CREATE UNIQUE INDEX ocr_documents_pkey ON public.ocr_documents USING btree (id)

### ocr_line_items
- Category: ocr
- Exists: Yes
- Row count: 1
- Missing columns: None
- Columns:
  - id: uuid, nullable=NO (default: gen_random_uuid())
  - tenant_id: text, nullable=NO
  - ocr_document_id: uuid, nullable=YES
  - line_index: integer, nullable=NO
  - sku: text, nullable=YES
  - description: text, nullable=YES
  - qty: numeric, nullable=YES
  - unit_price: numeric, nullable=YES
  - total: numeric, nullable=YES
- Indexes:
  - ocr_line_items_pkey: CREATE UNIQUE INDEX ocr_line_items_pkey ON public.ocr_line_items USING btree (id)

### ocr_note_entities
- Category: ocr
- Exists: Yes
- Row count: 1
- Missing columns: None
- Columns:
  - id: uuid, nullable=NO (default: gen_random_uuid())
  - ocr_document_id: uuid, nullable=YES
  - label: text, nullable=NO
  - value: text, nullable=YES
  - tenant_id: uuid, nullable=YES
- Indexes:
  - ocr_note_entities_pkey: CREATE UNIQUE INDEX ocr_note_entities_pkey ON public.ocr_note_entities USING btree (id)

### vendor_aliases
- Category: ocr
- Exists: Yes
- Row count: 1
- Missing columns: None
- Columns:
  - id: uuid, nullable=NO (default: gen_random_uuid())
  - vendor_id: uuid, nullable=NO
  - alias: text, nullable=NO
  - tenant_id: uuid, nullable=YES
- Indexes:
  - vendor_aliases_pkey: CREATE UNIQUE INDEX vendor_aliases_pkey ON public.vendor_aliases USING btree (id)

### vendor_locations
- Category: ocr
- Exists: Yes
- Row count: 1
- Missing columns: None
- Columns:
  - id: uuid, nullable=NO (default: gen_random_uuid())
  - vendor_id: uuid, nullable=NO
  - address: text, nullable=YES
  - city: text, nullable=YES
  - state: text, nullable=YES
  - postal_code: text, nullable=YES
  - country: text, nullable=YES
  - tenant_id: uuid, nullable=YES
- Indexes:
  - vendor_locations_pkey: CREATE UNIQUE INDEX vendor_locations_pkey ON public.vendor_locations USING btree (id)
