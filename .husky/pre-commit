#!/bin/sh
. "$(dirname "$0")/_/husky.sh" 2>/dev/null || true

# Run quick type check first (fast fail)
echo "🔍 Running quick type check..."
npm run type-check

# Also check Next.js build types (what Railway actually runs)
echo "🔍 Checking Next.js build compatibility..."
npx next build --dry-run 2>/dev/null || echo "⚠️  Next.js build check failed - run 'npm run test:railway' for details"
if [ $? -ne 0 ]; then
  echo "❌ Type check failed! Fix errors before committing."
  echo "💡 To bypass in emergency: git commit --no-verify"
  exit 1
fi

# Run lint-staged for changed files
echo "🔍 Running lint-staged on changed files..."
npx lint-staged

# Optional: Run full pre-commit checks (uncomment if desired)
# echo "🔍 Running full pre-commit checks..."
# npm run pre-commit

echo "✅ Pre-commit checks passed!"
