#!/bin/sh
. "$(dirname "$0")/_/husky.sh" 2>/dev/null || true

# Run quick type check first (fast fail)
echo "ğŸ” Running quick type check..."
npm run type-check

# Also check Next.js build types (what Railway actually runs)
echo "ğŸ” Checking Next.js build compatibility..."
npx next build --dry-run 2>/dev/null || echo "âš ï¸  Next.js build check failed - run 'npm run test:railway' for details"
if [ $? -ne 0 ]; then
  echo "âŒ Type check failed! Fix errors before committing."
  echo "ğŸ’¡ To bypass in emergency: git commit --no-verify"
  exit 1
fi

# Run lint-staged for changed files
echo "ğŸ” Running lint-staged on changed files..."
npx lint-staged

# Optional: Run full pre-commit checks (uncomment if desired)
# echo "ğŸ” Running full pre-commit checks..."
# npm run pre-commit

echo "âœ… Pre-commit checks passed!"
